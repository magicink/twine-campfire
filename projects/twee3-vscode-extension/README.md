# Twee 3 Storybuilder VS Code Extension

The Twee 3 Storybuilder extension adds syntax highlighting, special passage snippets, StorySettings validation, and StoryData completions for standard Twee 3 `.twee` and `.tws` files in Visual Studio Code. Use it when authoring Twine projects to keep passage headers, StorySettings, and StoryData entries tidy.

## Features

- TextMate grammar that highlights Twee 3 passage headers, macros, and wiki-links alongside Markdown.
- Colon-triggered completions for Twee 3 special passages including `StoryTitle`, `StorySettings`, `StoryData`, `UserStylesheet`, and more.
- JSON key suggestions for StoryData along with StorySettings toggle snippets and validation diagnostics for unsupported options.
- StoryData validation that requires an `ifid` and warns when the UUID is missing or malformed.
- Command palette and Run menu entry that generates a fresh StoryData IFID for the active Twee 3 document.

## Prerequisites

- [Bun](https://bun.sh/) 1.0 or later
- [Node.js](https://nodejs.org/) 18 or later (required by the VS Code packaging tool)
- [Visual Studio Code](https://code.visualstudio.com/)

## Install dependencies

From the repository root, install the workspace dependencies (this also pulls the extension's TypeScript tooling):

```sh
bun install
```

## Build the extension

Compile the TypeScript source to `dist/extension.js` before packaging or running the extension in a development host:

```sh
bun run --filter twee3-storybuilder build
```

To watch for changes while developing, use:

```sh
bun run --filter twee3-storybuilder watch
```

## Package the extension

Create a distributable `.vsix` archive using the bundled `vsce` CLI. The packaging script passes `--no-dependencies` so that `vsce` skips `npm list` validation (our workspace is managed by Bun rather than `npm`).

```sh
bun run --filter twee3-storybuilder package
```

The command writes `twee3-storybuilder-<version>.vsix` to the extension directory.

## Install into VS Code

1. Open Visual Studio Code.
2. Press <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>P</kbd> (or <kbd>Cmd</kbd>+<kbd>Shift</kbd>+<kbd>P</kbd> on macOS) to open the command palette.
3. Run **Extensions: Install from VSIX...** and select the generated `.vsix` file.
4. Reload VS Code if prompted.

After installation, open or create a file with the `.twee` or `.tws` extension to activate the Twee 3 language features.

## Generate StoryData IFIDs

Use the **Run â†’ Generate StoryData IFID** menu item (or run **Twee 3: Generate StoryData IFID** from the command palette) to create a UUID for the `StoryData` passage. The command updates the IFID in place when it already exists or inserts a new JSON block when the passage is empty. Fix any JSON syntax errors flagged by diagnostics before running the command.

## Twee 3 passage headers

Twee 3 expects passage headers to follow a four-part structure on a single line:

1. `::` followed by a space.
2. The passage name.
3. Optional tags in square brackets.
4. Optional JSON metadata, such as coordinates generated by Twine.

For example:

```twee
:: Snoopy [dog peanuts] {"position":"320,180","size":"160,120"}
```

The `Passage header` snippet inserts placeholders for each component so you can tab through, fill in values, or delete the optional segments.

## Updating the extension version

The extension's version number lives in `projects/twee3-vscode-extension/package.json`. Increment it when you ship new functionality so that VS Code recognizes the update when re-installing the `.vsix` file.
