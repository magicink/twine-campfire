# Campfire Storybuilder VS Code Extension

The Campfire Storybuilder extension adds syntax highlighting, directive snippets, and IntelliSense completions for Campfire stories inside Visual Studio Code. Use it when drafting Twee 3 `.twee` or `.tws` files to get inline help for the Campfire directive syntax.

## Features

- TextMate grammar that layers Campfire directive tokens on top of Markdown and Twee 3 passage headers for accurate highlighting.
- Colon-triggered IntelliSense snippets for Campfire directives, Twee 3 passage headers, and reusable patterns such as slide decks and conditionals. The completions include all of the standard `Story*` special passages defined by Twee 3.
- Language configuration that wires up bracket matching and indentation behavior to keep directive blocks tidy.

## Prerequisites

- [Bun](https://bun.sh/) 1.0 or later
- [Node.js](https://nodejs.org/) 18 or later (required by the VS Code packaging tool)
- [Visual Studio Code](https://code.visualstudio.com/)

## Install dependencies

At the repository root, install the workspace dependencies (this also pulls the extension's TypeScript tooling):

```sh
bun install
```

## Build the extension

Compile the TypeScript source to `dist/extension.js` before packaging or running the extension in a development host:

```sh
bun run --filter campfire-storybuilder build
```

To watch for changes while developing, use:

```sh
bun run --filter campfire-storybuilder watch
```

## Package the extension

Create a distributable `.vsix` archive using the bundled `vsce` CLI. The packaging script passes `--no-dependencies` so that `vsce` skips `npm list` validation (our workspace is managed by Bun rather than `npm`).

```sh
bun run --filter campfire-storybuilder package
```

The command writes `campfire-storybuilder-<version>.vsix` to the extension directory.

## Install into VS Code

1. Open Visual Studio Code.
2. Press <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>P</kbd> (or <kbd>Cmd</kbd>+<kbd>Shift</kbd>+<kbd>P</kbd> on macOS) to open the command palette.
3. Run **Extensions: Install from VSIX...** and select the generated `.vsix` file.
4. Reload VS Code if prompted.

After installation, open or create a file with the `.twee` or `.tws` extension to activate the Campfire language features.

## Twee 3 passage headers

Twee 3 expects passage headers to follow a four-part structure on a single line:

1. `::` followed by a space.
2. The passage name.
3. Optional tags in square brackets.
4. Optional JSON metadata, such as coordinates generated by Twine.

For example:

```twee
:: Snoopy [dog peanuts] {"position":"320,180","size":"160,120"}
```

The `Passage header` snippet inserts placeholders for each component so you can tab through, fill in values, or delete the optional segments.

## Updating the extension version

The extension's version number lives in `projects/campfire-vscode-extension/package.json`. Increment it when you ship new functionality so that VS Code recognizes the update when re-installing the `.vsix` file.
